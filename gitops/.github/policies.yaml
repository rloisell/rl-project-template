apiVersion: v1
# .github/policies.yaml - Ryan Loisell, GitHub Copilot, February 2026, AI-assisted.
#
# Emerald Security Policy Configuration for Datree.
#
# Used by the Datree GitHub Action in .github/workflows/ci.yml to enforce ISB
# security policies against rendered Helm templates before they reach the cluster.
#
# DATREE_TOKEN must be obtained from ISB (Emerald platform team) and stored as
# a GitHub Actions Secret in this GitOps repo.
#
# Full ISB policy reference and additional policies:
#   https://github.com/bcgov-c/tenant-gitops-e648d1 (.github/policies.yaml)
#
# Replace <APP_NAME> references below to match your project.

policies:
  - name: emerald_policy
    isDefault: true
    rules:
      - identifier: CUSTOM_WORKLOAD_INCORRECT_DATACLASS_LABELS
        messageOnFailure: >
          All workloads in Emerald must include a DataClass label
          (app.kubernetes.io/data-class: Low | Medium | High | Critical).
          Confirm the correct DataClass value with Information Security.
      - identifier: CUSTOM_WORKLOAD_INCORRECT_ROUTE_DATACLASS_LABELS
        messageOnFailure: "Use only approved dataclass labels (dataclass-low, dataclass-medium, dataclass-high, dataclass-public)"
      - identifier: CUSTOM_WORKLOAD_INCORRECT_NETWORK_POLICIES
        messageOnFailure: "Ensure Network Policies have distinct and clear source and target rules"
      - identifier: CUSTOM_WORKLOAD_INCORRECT_ENVIRONMENT_LABELS
        messageOnFailure: "Use only approved environment labels (prod, test, dev)"
      - identifier: CUSTOM_WORKLOAD_MISSING_LABEL_OWNER_VALUE
        messageOnFailure: "Add a proper owner label to know which person/team to ping when needed"
      - identifier: CONTAINERS_MISSING_READINESSPROBE_KEY
        messageOnFailure: Missing property object readinessProbe - add a properly configured readinessProbe to notify kubelet your Pods are ready for traffic
      - identifier: CONTAINERS_MISSING_CPU_REQUEST_KEY
        messageOnFailure: Missing property object requests.cpu - value should be within the accepted boundaries recommended by the organization
      - identifier: CONTAINERS_MISSING_CPU_LIMIT_KEY
        messageOnFailure: Missing property object limits.cpu - value should be within the accepted boundaries recommended by the organization
      - identifier: CONTAINERS_INCORRECT_PRIVILEGED_VALUE_TRUE
        messageOnFailure: Incorrect value for key privileged - running privileged containers is not recommended
      - identifier: CONTAINERS_INCORRECT_HOSTPID_VALUE_TRUE
        messageOnFailure: Incorrect value for key hostPID - running on the host PID namespace exposes sensitive process information
